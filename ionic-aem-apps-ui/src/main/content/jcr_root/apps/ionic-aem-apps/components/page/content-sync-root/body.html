<body data-sly-use.contentSyncRoot="com.icfi.aem.apps.ionic.api.models.contentsync.root.ContentSyncRoot">

    <script type="text/javascript" src="/cordova.js"></script>
    <script>
        // Redirect to the following path once init has finished
        var successRedirectPath = '${contentSyncRoot.applicationRootPath @ context="scriptString"}';

        var initializationComplete = function(error, localContentPath) {
            if (error) {
                alert("ContentSync init error: " + error);
                return console.error("ContentSync init error: " + error);
            }

            // App was successfully initialized. Redirect to the new local content path.
            alert("ContentSync success. Returned path: [" + localContentPath + "]");
            console.log("ContentSync success. Returned path: [" + localContentPath + "]");
            return window.location.href = localContentPath + successRedirectPath;
        };

        var initializeApplication = function() {
            alert('deviceReady fired.  initialization about to start.');
            var contentInitializer = CQ.mobile.contentInit({
                id: '${contentSyncRoot.applicationName @ context="scriptString"}'
            });
            contentInitializer.initializeApplication(initializationComplete);
        };

        alert('Script fired.');

        // Begin initialization once Cordova bridge is ready
        document.addEventListener('deviceready', initializeApplication, false)
    </script>
    <p>
        Redirect Path: '${contentSyncRoot.applicationRootPath}'
    </p>
    <p>
        Application Id: '${contentSyncRoot.applicationName}'
    </p>
    <p>
        Is Application Root Configured : ${contentSyncRoot.applicationRootConfigured}
    </p>

    <sly data-sly-use.clientLib="${'/libs/granite/sightly/templates/clientlib.html'}"
         data-sly-call="${clientLib.js @ categories='ionic-aem-apps.content-sync.all'}" />

</body>
